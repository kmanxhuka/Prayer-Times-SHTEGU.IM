<!doctype html>
<html lang="sq">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kohët e Namazit</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body{
      margin:0;
      font-family:Inter,system-ui,sans-serif;
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
      color:#fff;
      display:flex;
      justify-content:center;
      align-items:stretch;
      height:100vh
    }
    .wrap{
      display:grid;
      grid-template-columns:0.2fr 1fr 1fr; /* left box narrower */
      gap:20px;
      width:100%;
      padding:20px;
    }

    .box{
      background: rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.25);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      backdrop-filter: blur(20px) saturate(150%);
      -webkit-backdrop-filter: blur(20px) saturate(150%);
      padding:20px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      overflow:auto;
    }

    .info-time{font-size:40px;font-weight:700;color:#fff;margin-bottom:8px;letter-spacing:2px}
    .info-time .colon{animation:pulse 1s infinite;}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0}}

    .info-date{font-size:16px;color:#fff;margin:4px 0}

    .next-label{font-size:22px;color:#fff;margin-bottom:12px}
    .next-time{font-size:48px;font-weight:700;color:#fff}

    .times-box{display:flex;flex-direction:column;gap:10px;width:100%}
    .prayer{text-align:center;padding:10px;border:none;background:transparent;display:flex;flex-direction:column;justify-content:center}
    .prayer-name{font-size:14px;margin-bottom:6px;color:#cfe1ff}
    .prayer-time{font-size:18px;font-weight:600;color:#cfe1ff}

    .quotes-box{font-size:18px;line-height:1.6;text-align:center;color:#fff}
    .quotes-box h2{margin-bottom:10px;font-size:20px;color:#76d3ff}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/sq.js"></script>
</head>
<body>
  <div class="wrap">
    <!-- Left Column: Prayer Times -->
    <div class="box">
      <div class="info-time" id="currentClock">--:--</div>
      <div class="info-date" id="weekday">—</div>
      <div class="info-date" id="hijriDate">Hixhri: —</div>
      <div class="info-date" id="gregDate">Gregorian: —</div>
      <div class="next-label" id="nextLabel">—</div>
      <div class="next-time" id="nextTime">--</div>
      <div class="times-box" id="timesBox"></div>
    </div>

    <!-- Middle Column: Albanian Quotes -->
    <div class="box quotes-box">
      <h2>Thënie në shqip</h2>
      <div id="quotesSq">“Mos e humb shpresën, edhe pas natës më të errët lind dielli.”</div>
    </div>

    <!-- Right Column: Arabic Quotes -->
    <div class="box quotes-box">
      <h2>اقتباسات بالعربية</h2>
      <div id="quotesAr">“وَمَا تَوْفِيقِي إِلَّا بِاللَّهِ”</div>
    </div>
  </div>

  <script>
  dayjs.locale('sq');
  const $ = sel=>document.querySelector(sel);
  let prayers=[];
  let currentIndex=-1;

  const hijriMonths = [
    "Muharrem","Safer","Rebiu Evel","Rebiu Ahir","Xhumada Ula","Xhumada Ahire","Rexheb","Shaban","Ramadan","Sheval","Dhul Ka'de","Dhul Hixhe"
  ];

  const gregMonths = ["Janar","Shkurt","Mars","Prill","Maj","Qershor","Korrik","Gusht","Shtator","Tetor","Nëntor","Dhjetor"];

  const backgrounds = [
    'https://images.unsplash.com/photo-1503264116251-35a269479413?auto=format&fit=crop&w=1950&q=80',
    'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1950&q=80',
    'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1950&q=80',
    'https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1950&q=80'
  ];
  document.body.style.backgroundImage=`url('${backgrounds[Math.floor(Math.random()*backgrounds.length)]}')`;

  function render(){
    const box=$('#timesBox');box.innerHTML='';
    prayers.forEach((p)=>{
      const div=document.createElement('div');
      div.className='prayer';
      const name=document.createElement('div');
      name.className='prayer-name';
      name.textContent=p.name;
      const time=document.createElement('div');
      time.className='prayer-time';
      time.textContent=p.time;
      div.appendChild(name);
      div.appendChild(time);
      box.appendChild(div);
    });
  }

  function formatClock(now){
    const h=now.format('HH');
    const m=now.format('mm');
    return `${h}<span class="colon">:</span>${m}`;
  }

  function tick(){
    if(prayers.length===0) return;
    const now=dayjs();
    let idx=-1;
    for(let i=0;i<prayers.length;i++){
      if(now.isAfter(prayers[i].at)) idx=i;
    }
    currentIndex=idx;
    render();
    const next=prayers[idx+1];
    if(next){
      const diff=next.at.diff(now);
      const mins=Math.floor(diff/60000);
      if(mins > 59){
        const hours=Math.floor(mins/60);
        const remMins=mins%60;
        $('#nextLabel').textContent=`${next.name} edhe`;
        $('#nextTime').textContent=`${hours} orë e ${remMins.toString().padStart(2,'0')} min`;
      } else {
        $('#nextLabel').textContent=`${next.name} edhe`;
        $('#nextTime').textContent=`${mins} min`;
      }
    }else{
      $('#nextLabel').textContent='Dita ka përfunduar';
      $('#nextTime').textContent='';
    }

    $('#currentClock').innerHTML=formatClock(now);
    $('#weekday').textContent=now.format('dddd');
    $('#gregDate').textContent=`${now.date()} ${gregMonths[now.month()]} ${now.year()}`;
  }

  async function loadHijri(){
    const today=dayjs().format('DD-MM-YYYY');
    try{
      const res=await fetch(`https://api.aladhan.com/v1/gToH?date=${today}`);
      const data=await res.json();
      if(data.data && data.data.hijri){
        const hijri=data.data.hijri;
        const d = hijri.day;
        const m = parseInt(hijri.month.number,10);
        const y = hijri.year;
        const monthName = hijriMonths[m-1] || hijri.month.en;
        $('#hijriDate').textContent=`${d} ${monthName} (${m}) ${y}`;
      }
    }catch(e){
      console.error('Gabim në marrjen e datës Hixhri',e);
      $('#hijriDate').textContent='—';
    }
  }

  async function loadCsv(text){
    const parsed=Papa.parse(text.trim());
    const headers=parsed.data[0].map(h=>h.toLowerCase());
    const idx={
      day:headers.findIndex(h=>h.includes('day')),
      month:headers.findIndex(h=>h.includes('month')),
      fajr:headers.findIndex(h=>h.includes('fajr')||h.includes('imsak')),
      dhuhr:headers.findIndex(h=>h.includes('dhuhr')||h.includes('zuhr')),
      asr:headers.findIndex(h=>h.includes('asr')),
      maghrib:headers.findIndex(h=>h.includes('maghrib')),
      isha:headers.findIndex(h=>h.includes('isha'))
    };
    const today=dayjs();
    const row=parsed.data.find((r,i)=>{
      if(i===0) return false;
      const d=parseInt(r[idx.day],10);
      const m=parseInt(r[idx.month],10);
      return d===today.date() && m===today.month()+1;
    });
    if(!row){alert('Nuk u gjet rreshti për sot');return;}
    prayers=[
      {key:'fajr', name:'Sabahu'},
      {key:'dhuhr', name:'Dreka'},
      {key:'asr', name:'Ikindia'},
      {key:'maghrib', name:'Akshami'},
      {key:'isha', name:'Jacia'}
    ].map(item=>{
      const col=idx[item.key];
      const time=row[col];
      if(!time||!time.includes(':')) return null;
      const [h,m]=time.split(':').map(Number);
      const at = today.startOf('day').set('hour',h).set('minute',m).set('second',0);
      return {name:item.name,time,at};
    }).filter(Boolean);
    setInterval(tick,1000);tick();
  }

  fetch("prayer_times.csv")
    .then(r=>r.text())
    .then(loadCsv)
    .catch(err=>{
      console.error('Ngarkimi automatik dështoi',err);
      alert('Vendos këtë skedar HTML dhe CSV në të njëjtën dosje, pastaj shërbeje me një server lokal.');
    });

  loadHijri();
  </script>
</body>
</html>